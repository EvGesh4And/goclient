{% extends 'base_knyazev.html' %}

{% block content %}

<div class="student-container">
  <h2>Список студентов</h2>

  {% include 'flash_messages_knyazev.html' %}

  <div class="controls">
    <form class="form-inline" method="get" action="{{ url_for(blueprint_name ~ '.add') }}">
      <label>
        <select name="type" required>
          <option value="">— выбрать тип —</option>
          {% for t in types %}
            <option value="{{ t[0] }}">{{ t[1] }}</option>
          {% endfor %}
        </select>
      </label>
      <button type="submit">Добавить</button>
    </form>
    
    <h3 style="margin-top:20px">Файлы</h3>
    <div class="file-forms">
      <form class="group" method="post" action="{{ url_for(blueprint_name ~ '.save') }}">
        <input name="filename" placeholder="Имя файла для сохранения" required>
        <button type="submit" class="secondary">Сохранить</button>
      </form>

      <form class="group" method="post" action="{{ url_for(blueprint_name ~ '.load') }}">
        <input name="filename" placeholder="Имя файла для загрузки" required>
        <button type="submit" class="secondary">Загрузить</button>
      </form>
    </div>

    <form action="{{ url_for(blueprint_name ~ '.clear_list') }}" method="post" onsubmit="return confirm('Очистить список ?');">
      <button type="submit" class="danger">Очистить список</button>
    </form>

    <form class="group" method="post" action="{{ url_for(blueprint_name ~ '.set_storage') }}">
      <label>
        <input type="radio" name="storage" value="SQLiteStorage"
              {% if current_storage == 'SQLiteStorage' %}checked{% endif %}>
        SQLiteStorage
      </label>
      <label>
        <input type="radio" name="storage" value="PickleStorage"
              {% if current_storage == 'PickleStorage' %}checked{% endif %}>
        PickleStorage
      </label>
      <button type="submit" class="secondary">Применить</button>
    </form>

    <div style="margin-left:auto" class="note">
      Всего: <strong>{{ indices|length }}</strong>
    </div>
  </div>

  <table class="students" role="table" aria-label="Список студентов">
    <thead>
      <tr>
        <th style="width:8%">ID</th>
        <th style="width:16%">Тип</th>
        <th>Данные</th>
        <th style="width:18%">Действия</th>
      </tr>
    </thead>
    <tbody>
      {% for i in indices %}
      {% set obj = items[i] %}
      <tr>
        <td><strong>{{ i }}</strong></td>
        <td><span class="type-badge">{{ obj.TYPE_NAME }}</span></td>
        <td>
          <ul class="data-list">
          {% for k, label in obj.fields.items() %}
            <li><strong>{{ label }}:</strong> {{ obj._data.get(k) or "-" }}</li>
          {% endfor %}
          </ul>
        </td>
        <td>
          <div class="actions">
            <a href="{{ url_for(blueprint_name ~ '.edit', index=i) }}">Редактировать</a>
            <form action="{{ url_for(blueprint_name ~ '.remove', index=i) }}" method="post" onsubmit="return confirm('Удалить запись #{{ i }}?');">
              <button type="submit" class="danger">Удалить</button>
            </form>
          </div>
        </td>
      </tr>
      {% else %}
      <tr>
        <td colspan="4" style="text-align:center; padding:18px; color:#6b7280;">Нет студентов</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}
